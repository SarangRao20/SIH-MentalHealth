{% extends "base.html" %}

{% block title %}Dashboard - MindCare{% endblock %}

{% block content %}
<div class="container-fluid py-4">

    <!-- Motivation Banner -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm border-0 bg-periwinkle text-white text-center p-5 rounded-3">
                <h2 class="fw-bold mb-3">ðŸŒŸ Stay Positive, Stay Strong ðŸŒŸ</h2>
                <p class="lead mb-0">"Every small step you take today brings you closer to a brighter tomorrow."</p>
            </div>
        </div>
    </div>

    <!-- Greeting & Streak -->
    <div class="row mb-4 align-items-center">
        <div class="col-lg-8 col-md-7">
            <h1 class="h3">Welcome back, {{ current_user.full_name }} ðŸ‘‹</h1>
            <p class="text-muted mb-0">How are you feeling today? Remember, every step counts.</p>
        </div>
        <div class="col-lg-4 col-md-5 text-md-end mt-3 mt-md-0">
            <div class="card shadow-sm border-0">
                <div class="card-body py-3 px-4">
                    <h6 class="text-dark mb-1"><i class="fas fa-fire text-danger me-2"></i>Login Streak</h6>
                    <h4 class="text-info mb-0">{{ login_streak }} day{{ 's' if login_streak != 1 }}</h4>
                </div>
            </div>
        </div>
    </div>

    <!-- Key Metrics -->
    <div class="row g-4 mb-4">
        <div class="col-lg-4 col-md-6">
            <div class="card h-100 shadow-sm border-0">
                <div class="card-body text-center p-4">
                    <h6 class="text-dark mb-2"><i class="fas fa-leaf text-success me-2"></i>Meditation</h6>
                    <h2 class="text-periwinkle">{{ total_minutes_meditated }} min</h2>
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-md-6">
            <div class="card h-100 shadow-sm border-0">
                <div class="card-body text-center p-4">
                    <h6 class="text-dark mb-2"><i class="fas fa-check-circle text-success me-2"></i>Tasks</h6>
                    <h2 class="text-success">{{ tasks_completed }}/{{ total_tasks }}</h2>
                    <p class="text-muted mb-2">Completed today</p>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-success" style="width: {{ tasks_progress|default(0) }}%;" 
                             role="progressbar" aria-valuenow="{{ tasks_progress|default(0) }}" aria-valuemin="0" aria-valuemax="100">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-md-12">
            <div class="card h-100 shadow-sm border-0 bg-light">
                <div class="card-body d-flex flex-column justify-content-center text-center p-4">
                    <h6 class="text-dark mb-2"><i class="fas fa-star text-warning me-2"></i>Daily Inspiration</h6>
                    <p class="lead fst-italic mb-0">"Every small step forward is progress worth celebrating."</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row g-4 mb-4">
        <div class="col-md-4">
            <div class="card action-card h-100 shadow-sm border-0 text-center">
                <a href="{{ url_for('meditation') }}" class="d-block p-4 text-dark text-decoration-none">
                    <h6 class="fw-semibold"><i class="fas fa-seedling text-warning me-2"></i>Start Meditation</h6>
                    <small class="text-muted">Take a moment to breathe and center yourself</small>
                </a>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card action-card h-100 shadow-sm border-0 text-center">
                <a href="{{ url_for('routine') }}" class="d-block p-4 text-dark text-decoration-none">
                    <h6 class="fw-semibold"><i class="fas fa-calendar-check text-info me-2"></i>Plan Your Day</h6>
                    <small class="text-muted">Organize tasks and set goals</small>
                </a>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card action-card h-100 shadow-sm border-0 text-center">
                <a href="{{ url_for('assessments') }}" class="d-block p-4 text-dark text-decoration-none">
                    <h6 class="fw-semibold"><i class="fas fa-smile text-success me-2"></i>Track your assessments</h6>
                    <small class="text-muted">Quick assessment to track your wellbeing</small>
                </a>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-4">
        <div class="col-md-4">
            <div class="card action-card h-100 shadow-sm border-0 text-center">
                <a href="{{ url_for('venting_hall') }}" class="d-block p-4 text-dark text-decoration-none">
                    <h6 class="fw-semibold"><i class="fas fa-cloud-sun text-info me-2"></i>Venting Hall</h6>
                    <small class="text-muted">Share your thoughts with the community</small>
                </a>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card action-card h-100 shadow-sm border-0 text-center">
                <a href="{{ url_for('consultation') }}" class="d-block p-4 text-dark text-decoration-none">
                    <h6 class="fw-semibold"><i class="fas fa-user-friends text-success me-2"></i>Get Support</h6>
                    <small class="text-muted">Connect with counselors</small>
                </a>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card action-card h-100 shadow-sm border-0 text-center">
                <a href="{{ url_for('chatbot') }}" class="d-block p-4 text-dark text-decoration-none">
                    <h6 class="fw-semibold"><i class="fas fa-comments text-periwinkle me-2"></i>Chat Support</h6>
                    <small class="text-muted">Immediate support when you need it</small>
                </a>
            </div>
        </div>
    </div>

    <!-- Assessment History -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-periwinkle text-white">
                    <h6 class="mb-0"><i class="fas fa-history me-2"></i>Assessment History</h6>
                </div>
                <div class="card-body p-0">
                    {% if recent_assessments and recent_assessments|length > 0 %}
                    <div class="table-responsive">
                        <table class="table mb-0 align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Score</th>
                                    <th>Severity</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for assessment in recent_assessments %}
                                <tr>
                                    <td>{{ assessment.completed_at.strftime('%d-%b-%Y %I:%M %p') }}</td>
                                    <td>{{ assessment.assessment_type }}</td>
                                    <td>{{ assessment.score }}</td>
                                    <td>
                                        <span class="badge 
                                            {% if assessment.severity_level == 'High' %} bg-danger 
                                            {% elif assessment.severity_level == 'Moderate' %} bg-warning 
                                            {% else %} bg-success {% endif %}">
                                            {{ assessment.severity_level }}
                                        </span>
                                    </td>
                                    <td>
                                        <a href="{{ url_for('assessment_results', assessment_id=assessment.id) }}" 
                                           class="btn btn-sm btn-outline-primary">View Results</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="p-3 text-muted">No assessments found.</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}
